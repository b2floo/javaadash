<!DOCTYPE html>
<html>
    <head>
        <title> Real time multi-player games with HTML5</title>
        <meta charset="utf-8" />
		<!-- JQuery -->
		<script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>
		
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
        
        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">
        
		<style>
			body { 
				padding:20px;
			}
			#console { 
				height: 400px; 
				overflow: auto; 
			}
			.username-msg {color:orange;}
			.connect-msg {color:green;}
			.disconnect-msg {color:red;}
			.send-msg {color:#888}
		</style>
		
        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

		<script src="js/socket.io/socket.io.js"></script>
        <script src="js/moment.min.js"></script>
		
	
	<!-- This will create a connection to socket.io --> 
        <script type="text/javascript">
			
			var STATE_PLAYER_CHOOSE_CHARACTER = 3;
			var STATE_PLAYER_CHOOSE_ACTION = 4;
			var STATE_PLAYER_CHOOSE_DISCARD = 6;
			
			console.log( 'javascript -- start' );
			
           //This is all that needs
           var socket = io.connect('http://localhost:9092', {
             'reconnection delay' : 2000,
             'force new connection' : true
           });
           
           socket.on('connect', function() {
       		    console.log( 'Connected...' );
                // connection established, now we can send an objects
       		});
       		
       		function joinAnyGame() {
       		    var username = $('#username').val();
                var jsonObject = {username: username};
            	socket.emit('join_any_game', jsonObject);
			};
			
			socket.on('start_game', function(data) {
				output('<span class="username-msg">Starting a game with '+data.opponent+'!</span>');

				output('<span class="username-msg">Available characters: </span>');
				outputCardList(data.myCharacters);
				output('<span class="username-msg">Available cards: </span>');
				outputCardList(data.myHand);
				output('<span class="username-msg">Opponent characters: </span>');
				outputCardList(data.myOpponentCharacters);
				var characterCard = { 'characterCard' : data.myCharacters[0].id, 
				 '@class' : 'com.javaadash.tc2.core.interfaces.message.ChooseCharacterMessage'};
				socket.emit('choose_character', characterCard);
				var actionCards = { 'actionCards' : [data.myHand[0]], 
				 '@class' : 'com.javaadash.tc2.core.interfaces.message.ChooseActionMessage'};
				socket.emit('choose_action', actionCards);
       		});
       		
       		socket.on('update_game', function(data) {
                output('<span class="username-msg">Update :: turn '+data.turn+'</span>');

                output('<span class="username-msg">Available characters: </span>');
                outputCardList(data.myCharacters);
                output('<span class="username-msg">Available cards: </span>');
                outputCardList(data.myHand);
                output('<span class="username-msg">My board: </span>');
                outputCardList(data.myBoard);
                output('<span class="username-msg">My discard: </span>');
                outputCardList(data.myDiscard);
                output('<span class="username-msg">Opponent characters: </span>');
                outputCardList(data.myOpponentCharacters);
                output('<span class="username-msg">Opponent board: </span>');
                outputCardList(data.myOpponentBoard);
                output('<span class="username-msg">Opponent discard: </span>');
                outputCardList(data.myOpponentDiscard);
                // choose a card to discard
                if(data.gameState == STATE_PLAYER_CHOOSE_CHARACTER) {
	                var characterCard = { 'characterCard' : data.myCharacters[0].id, 
					 '@class' : 'com.javaadash.tc2.core.interfaces.message.ChooseCharacterMessage'};
					socket.emit('choose_character', characterCard);
					var actionCards = { 'actionCards' : [data.myHand[0]], 
				 	'@class' : 'com.javaadash.tc2.core.interfaces.message.ChooseActionMessage'};
					socket.emit('choose_action', actionCards);
                } else if(data.gameState == STATE_PLAYER_CHOOSE_DISCARD) {
	                var discardCards = { 'discardCards' : [data.myHand[0]], 
	                 '@class' : 'com.javaadash.tc2.core.interfaces.message.ChooseDiscardMessage'};
	                socket.emit('choose_discard', discardCards);
                }
            });
            
            socket.on('end_game', function(data) {
                output('<span class="username-msg">GAME OVER</span>');

                output('<span>Winner is: '+data.winner+' </span>');
                output('<span>Your score is: '+data.myScore+' </span>');
                output('<span>Opponent score is: '+data.myOpponentScore+' </span>');
            });


			function output(message) {
	            var currentTime = "<span class='time'>" +  moment().format('HH:mm:ss.SSS') + "</span>";
	            var element = $("<div>" + currentTime + " " + message + "</div>");
				$('#console').append(element);
			}

            function outputCardList(cards) {
              for(var i=0; i<cards.length; ++i) {
                  output('Card ID: '+ cards[i].id + '; LIFE: '+ cards[i].settings['LIFE'] + '; Available: '+cards[i].available);
              }    
            }

        </script>
    </head>
 
     <body>
        <!--<canvas id="canvas"> </canvas>  -->
        <h1>netty-socketio demo</h1>
	
		<br/>
	
	    <form class="well form-inline" onsubmit="return false;">
	       <input id="username" class="input-xlarge" type="text" placeholder="Enter your name--"/>
	       <button type="button" onClick="joinAnyGame()" class="btn">Join any game</button>
	    </form>

        <div class="container">
            <div class="panel panel-default">
              <div class="panel-body">
                <div class="row">
                    <!-- My characters-->
                    <div class="col-lg-2 col-md-2 col-sm-2">
                        <div class="panel panel-default">
                            <div class="panel-heading">My characters</div>
                            <div class="panel-body">
			                    <!-- image trigger modal -->
				                <a data-toggle="modal" data-target="#myModal">
				                  <img src="images/card1_small.png">
				                </a>
				                <a data-toggle="modal" data-target="#myModal">
				                  <img src="images/card1_small.png">
				                </a>
				                <a data-toggle="modal" data-target="#myModal">
				                  <img src="images/card1_small.png">
				                </a>
			                </div>
                        </div>
                    </div>
                    <!-- My actions -->
                    <div class="col-lg-2 col-md-2 col-sm-2">
                        <div class="panel panel-default">
                            <div class="panel-heading">My actions</div>
                                <div class="panel-body">
                                    <!-- image trigger modal -->
                                    <a data-toggle="modal" data-target="#myModal">
                                      <img src="images/card1_small.png">
                                    </a>
                                    <a data-toggle="modal" data-target="#myModal">
                                      <img src="images/card1_small.png">
                                    </a>
                                    <a data-toggle="modal" data-target="#myModal">
                                      <img src="images/card1_small.png">
                                    </a>
                                    <a data-toggle="modal" data-target="#myModal">
                                      <img src="images/card1_small.png">
                                    </a>
                                    <a data-toggle="modal" data-target="#myModal">
                                      <img src="images/card1_small.png">
                                    </a>
                                </div>
                            </div>
                        </div>
                        <!-- Opponents characters-->
                        <div class="col-lg-2 col-md-2 col-sm-2 pull-right">
                            <div class="panel panel-default">
                                <div class="panel-heading">Opponents characters</div>
                                <div class="panel-body">
			                        <!-- image trigger modal -->
				                    <a data-toggle="modal" data-target="#myModal">
				                      <img src="images/card1_small.png">
				                    </a>
				                    <a data-toggle="modal" data-target="#myModal">
				                      <img src="images/card1_small.png">
				                    </a>
				                    <a data-toggle="modal" data-target="#myModal">
				                      <img src="images/card1_small.png">
				                    </a>
			                    </div>
                            </div>
                        </div>
                    </div>

                </div>
              </div>
            </div>
        </div>
        
        <div id="console" class="well"></div>

		<!-- Modal -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		  <div class="modal-dialog">
			<div class="modal-content">
			  <div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
				<h4 class="modal-title" id="myModalLabel">Modal title</h4>
			  </div>
			  <div class="modal-body">
				...
			  </div>
			  <div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-primary">Save changes</button>
			  </div>
			</div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
		
    </body>
</html>
